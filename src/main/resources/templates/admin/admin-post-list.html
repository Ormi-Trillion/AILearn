<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/admin-post-list.css">
    <title>admin-post-list</title>

    <link rel="stylesheet" href="/css/admin-post-detail.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/css/header.css">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/js/main.js"></script>

</head>
<body>
<!-- 메뉴 부분 -->
<header th:replace="~{/layout/header::header}"></header>
<!-- 메뉴 부분 끝 -->

<div>
    <strong>게시글 리스트</strong>
<!--</div>-->
<div class="search-container">
    <input type="text" class="search-input" placeholder="search">
    <button type="submit" class="search-button">search</button>

    <button type="submit" class="post-button">글쓰기</button>
</div>

<table class="table">
    <tr class="header">
        <th class="num">번호</th>
        <th class="post-title">제목</th>
        <th>작성자</th>
        <th>작성일</th>
    </tr>
<tbody id="post-list" class="post-list"></tbody>
</table>

<div id="pagination" class="pagination"></div>
</div>
<!--<div class="page-container">-->
<!--    <ul id="post-list" class="post-list"></ul>-->
<!--    <div id="pagination" class="pagination"></div>-->
<!--</div>-->

<!--삭제 버튼-->
<!--<a><img src="/images/delete-icon.png"></a>-->

<script>
    // 헤더
    $(document).ready(function() {
        $("a.mainMenu").mouseenter(function () {
            $("header nav").stop().slideDown();
        });
        $("header nav a").mouseenter(function () {
            $("a.mainMenu").removeClass('act');
            $(this).parent().prev().addClass('act');
        });
        $("header ul").mouseleave(function () {
            $("a.mainMenu").removeClass('act');
            $("header nav").stop().slideUp();
        });

        //휠(스크롤) 위치에 따라 왼쪽메뉴 활성화.
        $(document).scroll(function(){
            //브라우저높이
            const h2 = $(window).height();

            const t1 = $(document).scrollTop();

            const ht = Math.floor(t1/h1);

            //모든클래스 삭제
            $("a").removeClass();
            //해당 메뉴만 클래스 추가
            $("li").eq(ht).children().addClass("menuOver "+"m"+(ht+1));
        });
    });

    //페이지
    const posts = Array.from({ length: 100 }, (_, i) => ({
        number: i + 1,
        title: `제목 ${i + 1}`,
        author: `작성자 ${i + 1}`,
        date: new Date(new Date().setDate(new Date().getDate() - i)).toLocaleDateString()
    }));

    const postsPerPage = 10;
    const pageButtonCount = 5; // 항상 표시할 페이지 번호 버튼 개수
    let currentPage = 1;
    let isPageChanging = false; // 페이지가 변경 중인지 여부를 추적하는 변수

    function renderPosts() {
        const postList = document.getElementById('post-list');
        postList.innerHTML = '';
        const start = (currentPage - 1) * postsPerPage;
        const end = start + postsPerPage;
        posts.slice(start, end).forEach(post => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
            <td class="number">${post.number}</td>
            <td>${post.title}</td>
            <td>${post.author}</td>
            <td>${post.date}</td>
        `;
            postList.appendChild(tr);
        });
    }

    function renderPagination() {
        const pagination = document.getElementById('pagination');
        pagination.innerHTML = '';
        const totalPages = Math.ceil(posts.length / postsPerPage);

        const createButton = (page, text, disabled = false, isActive = false) => {
            const button = document.createElement('button');
            button.textContent = text;
            button.disabled = disabled;
            button.className = disabled ? 'disabled' : (isActive ? 'active' : '');
            button.addEventListener('click', () => {
                if (!disabled) {
                    if (!isPageChanging) { // 페이지 변경 중이 아닐 때만 페이지를 변경합니다
                        isPageChanging = true;
                        currentPage = page;
                        update();
                        setTimeout(() => isPageChanging = false, 200); // 잠시 후 페이지 변경 상태를 초기화
                    }
                }
            });
            return button;
        };

        // Add First and Previous Buttons
        pagination.appendChild(createButton(1, '<<', currentPage === 1));
        pagination.appendChild(createButton(currentPage - 1, '<', currentPage === 1));

        // Add Page Number Buttons
        const halfRange = Math.floor(pageButtonCount / 2);
        let startPage = Math.max(1, currentPage - halfRange);
        let endPage = Math.min(totalPages, currentPage + halfRange);

        // Adjust range if there are not enough pages before or after the current page
        if (currentPage - halfRange < 1) {
            endPage = Math.min(totalPages, endPage + (halfRange - (currentPage - 1)));
        }
        if (currentPage + halfRange > totalPages) {
            startPage = Math.max(1, startPage - ((currentPage + halfRange) - totalPages));
        }

        for (let page = startPage; page <= endPage; page++) {
            pagination.appendChild(createButton(page, page, false, page === currentPage));
        }

        // Add Next and Last Buttons
        pagination.appendChild(createButton(currentPage + 1, '>', currentPage === totalPages));
        pagination.appendChild(createButton(totalPages, '>>', currentPage === totalPages));
    }

    function update() {
        renderPosts();
        renderPagination();
    }

    update();
</script>

</body>
</html>